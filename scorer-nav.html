<base target="_parent">

<script>
          function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
          }

</script>
<button id="authorize_button" style="display: none;">Sign in</button>
<button id="signout_button" style="display: none;">Sign Out</button>

    <div id="content"></div>

   <script type="text/javascript">
      // Client ID and API key from the Developer Console
          var CLIENT_ID = '901774097490-294f3s7it32rh65oodpclij4alj81h2m.apps.googleusercontent.com';
	  var API_KEY = 'AIzaSyDQp4VLGP04s6X6Efp96waVV4NjYvTirYc';
      // Array of API discovery doc URLs for APIs used by the quickstart
      var DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];

      // Authorization scopes required by the API; multiple scopes can be
      // included, separated by spaces.
      var SCOPES = "https://www.googleapis.com/auth/spreadsheets.readonly";

      var authorizeButton = document.getElementById('authorize_button');
      var signoutButton = document.getElementById('signout_button');

      /**
       *  On load, called to load the auth2 library and API client library.
       */
      function handleClientLoad() {
        gapi.load('client:auth2', initClient);
      }

      /**
       *  Initializes the API client library and sets up sign-in state
       *  listeners.
       */
      function initClient() {
        gapi.client.init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          discoveryDocs: DISCOVERY_DOCS,
          scope: SCOPES
        }).then(function () {
          // Listen for sign-in state changes.
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

          // Handle the initial sign-in state.
          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
          authorizeButton.onclick = handleAuthClick;
          signoutButton.onclick = handleSignoutClick;
        });
      }

      /**
       *  Called when the signed in status changes, to update the UI
       *  appropriately. After a sign-in, the API is called.
       */
      function updateSigninStatus(isSignedIn) {
        if (isSignedIn) {
          authorizeButton.style.display = 'none';
          signoutButton.style.display = 'block';
          listMajors();
        } else {
          authorizeButton.style.display = 'block';
          signoutButton.style.display = 'none';
        }
      }

      /**
       *  Sign in the user upon button click.
       */
      function handleAuthClick(event) {
        gapi.auth2.getAuthInstance().signIn();
      }

      /**
       *  Sign out the user upon button click.
       */
      function handleSignoutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
      }

      /**
       * Append a pre element to the body containing the given message
       * as its text node. Used to display the results of the API call.
       *
       * @param {string} message Text to be placed in pre element.
       */
      function appendPre(message) {
        var pre = document.getElementById('content');
      var textContent = message + "<br>"
      //document.createTextNode(message + '\n');
        pre.innerHTML = pre.innerHTML + textContent;
      }

      /**
       * Print the names and majors of students in a sample spreadsheet:
       * https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit
       */
      function listMajors() {



	  
	  gapi.client.sheets.spreadsheets.values.get({
	      spreadsheetId: '11eecocqxnYIqsYY-24pGfqPwhAEanU9mvCK4G43Abj0',
	      range: 'A:D',
	  }).then(function(response) {
	      var range = response.result;
	      if (range.values.length > 0) {
		  for (i = 0; i < range.values.length; i++) {
		      var row = range.values[i];
		      // Print columns A and E, which correspond to indices 0 and 4.
		      //              appendPre(row[0] + ': <a href="links.html?tourn=' + row[0] + '&score='+row[1]+'&mission='+row[2]+'&config='+row[3]+'">link</a>');

		      if (row[0] == getParameterByName('tourn')) {
			  datalink = '?tourn=' + row[0] + '&score='+row[1]+'&mission='+row[2]+'&config='+row[3]
			  alert(row[0])
			  val = row
			  
			  
			  gapi.client.sheets.spreadsheets.values.get({
			      spreadsheetId: val[1],
			      range: 'A:Z',
			  }).then(function(response) {
			      var rangesc = response.result;  
			      
			      gapi.client.sheets.spreadsheets.values.get({
				  spreadsheetId: val[3],
				  range: 'A:Z',
			      }).then(function(response) {
				  var range = response.result;
				  if (range.values.length > 0) {
				        document.write("<center><!--<h1>"+getParameterByName('tourn')+" Score Launcher</h1>-->");

				      for (i = 0; i < range.values.length; i++) {
					  var row = range.values[i];
					  if (row[0] == "# of rounds:") {
					      //alert(row[1])
					      rounds = parseInt(row[1])
					      x = 1
					      tmp = ""
					      while (x <= rounds) {
						  tmp = tmp + "<td>Round "+x+"</td>"
						  x++
					      }

					      document.write('Language: <select id="lang">\
  <option value="en">English</option>\
  <option value="es">Spanish</option>\
  <option value="pt">Portuguese</option>\
  <option value="de">German</option>\
  <option value="el">Greek</option>\
  <option value="tr">Turkish</option>\
  <option value="ro">Romanian</option>\
</select><br>')
					      
					      document.write("<table id='sort' border='1'><tr><td>Rank</td><td>Team</td>"+tmp+"<td>High Score</td></tr>")

					  }

					  //<button onclick="window.location.href = \'scorer/index.html\'+datalink+\'&team='+row[1]+'&round=1\'">
					  if (i >= 2) {
					      var row = range.values[i];
					      //alert(row)
					      // Print columns A and E, which correspond to indices 0 and 4.
					      //              appendPre(row[0] + ': <a href="links.html?tourn=' + row[0] + '&score='+row[1]+'&mission='+row[2]+'&config='+row[3]+'">link</a>');
					      //				document.write(row[0]+" "+row[1]+"<br>")
					      for (b = 0; b < rangesc.values.length; b++) {
						  var rowsc = rangesc.values[b];
						//  alert(b + " " + parseInt(row[1])+ " " + rowsc[0])
						  
						  if (b == i)  {
						      rowscnum = []
						      x = 0
						      while (x < rounds) {
							  rowscnum.push(parseInt(rowsc[x]))
							  x++
						      }
						      tmp = ""
						      x = 0
						      while (x < rounds) {
							  tmp = tmp + '<td><button onclick="window.parent.location.href = \'scorer/index.html\'+datalink+\'&team='+row[1]+'&round='+(x+1)+'&index='+i+'&lang=\'+language.value+\'\'">' + rowscnum[x]+'</button></td>'
							  x++
						      }
						      document.write('<td><text class="rank"></text></td><td>'+row[0]+' #'+row[1] + ':</td> '+tmp+'<td>'+Math.max.apply(null,rowscnum)+'</td></tr>');
						  }

						  	 
					      }
				
					  }
				
				      }
				      document.write("</table></center>")
				    //  document.write('<scr'+''+'ipt>function sortTable() {  var table, rows, switching, i, x, y, shouldSwitch;  table = document.getElementById("sort");  switching = true;  while (switching) {    switching = false;    rows = table.rows;    for (i = 1; i < (rows.length - 1); i++) {      shouldSwitch = false;      x = rows[i].getElementsByTagName("TD")[5];      y = rows[i + 1].getElementsByTagName("TD")[5];      if (Number(x.innerHTML) < Number(y.innerHTML)) {        shouldSwitch = true;        break;      }    }    if (shouldSwitch) {      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);      switching = true;    }  }};sortTable()</scri'+''+'pt>')
				      document.write('<script>language = document.getElementById("lang");a=1; while (a<=document.getElementsByClassName("rank").length){document.getElementsByClassName("rank")[a-1].innerHTML = "disabled";a++;}</scr'+''+'ipt>')

				  }
			      }, function(response) {
				  appendPre('Error: ' + response.result.error.message);
			      });
				  
				  
				  
			  }, function(response) {
			      appendPre('Error: ' + response.result.error.message);
			  });
				  
				  
				  
				  
				  
				  
		      }
		  }
	      } else {
		  appendPre('No data found.');
	      }
	  }, function(response) {
	      appendPre('Error: ' + response.result.error.message);
	  });
      }
      
function appendValues(spreadsheetId, range, valueInputOption, _values, callback) {
  var values = _values
  var body = {
    values: values
  };
  gapi.client.sheets.spreadsheets.values.append({
    spreadsheetId: spreadsheetId,
    range: range,
    valueInputOption: valueInputOption,
    resource: body
  }).then((response) => {
    var result = response.result;
    console.log(`${result.updates.updatedCells} cells appended.`)
      document.getElementById('content').innerHTML = ""
      listMajors()
      
  });
}


    </script>

    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
